# Build script for util-linux.
# SPDX-License-Identifier: Apache-2.0
# SPDX-FileCopyrightText: 2025, John Unland

version=2.40.2

cd -- "$TMPDIR"

rm -rf util-linux-$version

unpack "${worktree}/sources/util-linux-$version.tar.xz"

cd util-linux-$version

mkdir -pv /var/lib/hwclock

./configure \
    
    ADJTIME_PATH=/var/lib/hwclock/adjtime \
    --libdir=/usr/lib \
    --runstatedir=/run \
    --disable-chfn-chsh \
    --disable-login \
    --disable-nologin \
    --disable-su \
    --disable-setpriv \
    --disable-runuser \
    --disable-pylibmount \
    --disable-static \
    --disable-liblastlog2 \
    --without-python \
    --docdir=/usr/share/doc/util-linux-2.40.2

make -j${jobs}

make -j${jobs} install

cleanup() {
    cd -- "$TMPDIR" && rm -rf util-linux-$version
}

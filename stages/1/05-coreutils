# Build script for coreutils.
# SPDX-License-Identifier: Apache-2.0
# SPDX-FileCopyrightText: 2025, John Unland

version=9.5

cd -- "$TMPDIR"

rm -rf coreutils-${version}

unpack "${worktree}/sources/coreutils-${version}.tar.xz"

# Build instructions
cd coreutils-${version}

./configure \
    CFLAGS="$BTCFLAGS" CXXFLAGS="$BTCXXFLAGS" LDFLAGS="$BTLDFLAGS" \
    --prefix=/usr \
    --host=$target \
    --build=$host \
    --enable-install-program=hostname \
    --enable-no-install-program=kill,uptime

make -j${jobs}

make DESTDIR="${LFS}" install

# Move programs to final expected locations.
mv -v $LFS/usr/bin/chroot $LFS/usr/sbin
mkdir -pv $LFS/usr/share/man/man8
mv -v $LFS/usr/share/man/man1/chroot.1 $LFS/usr/share/man/man8/chroot.8
sed -i 's/"1"/"8"/' $LFS/usr/share/man/man8/chroot.8

cleanup() {
    cd -- "$TMPDIR" && rm -rf coreutils-${version}
}

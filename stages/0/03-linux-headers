# Build script for linux-kernel (headers).
# SPDX-License-Identifier: Apache-2.0
# SPDX-FileCopyrightText: 2025, John Unland

version=6.10.5

cd -- "$TMPDIR"

rm -rf linux-${version}
unpack "${worktree}/sources/linux-${version}.tar.xz"

# Build instructions
cd linux-${version}

# patch -p1 <"${worktree}/patches/linux-headers-remove-sysinfo-header.patch"
# patch -p1 <"${worktree}/patches/linux-headers-revert-broken-uapi.patch"

make -j1 ARCH="$kernel_arch" mrproper
make -j1 ARCH="$kernel_arch" headers

find usr/include -type f ! -name '*.h' -delete

make -j1 ARCH="$kernel_arch" INSTALL_HDR_PATH="${LFS}/usr" headers_install

cleanup() {
    cd -- "$TMPDIR" && rm -rf linux-${version}
}

# Build script for linux-libre (headers).
# SPDX-License-Identifier: Apache-2.0

version=6.1.23

cd -- "$TMPDIR"
rm -rf linux-${version}
unpack "${worktree}/sources/linux-${version}.tar.xz"

# Build instructions
cd linux-${version}

patch -p1 <"${worktree}/patches/linux-headers/revert-broken-uapi.patch"
patch -p1 <"${worktree}/patches/linux-headers/0003-remove-inclusion-of-sysinfo.h-in-kernel.h.patch"

make -j1 mrproper
make -j1 headers ARCH="$kernel_arch"
mkdir -p -- "${sysrootdir}/include"

make -j1 headers_install ARCH="$kernel_arch" INSTALL_HDR_PATH="${sysrootdir}/"

cleanup() {
    cd -- "$TMPDIR" && rm -rf linux-${version}
}
